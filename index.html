<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PIPI FIXED | HLS HTTPS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.0/hls.min.js"></script>
    <style>
        body { background: #000; margin: 0; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; }
        header { padding: 5px; background: #222; display: flex; gap: 10px; border-bottom: 2px solid #00ff00; }
        button { cursor: pointer; padding: 5px 10px; background: #444; color: #fff; border: 1px solid #666; }
        #video-grid { flex-grow: 1; display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); gap: 1px; }
        .cam-box { position: relative; background: #111; border: 1px solid #333; overflow: hidden; display: flex; align-items: center; justify-content: center;}
        video { width: 100%; height: 100%; object-fit: contain; }
        .label { position: absolute; top: 0; left: 0; background: rgba(0,0,0,0.7); padding: 2px 5px; font-size: 10px; color: #00ff00; z-index: 2;}
        .error-msg { position: absolute; color: red; font-size: 10px; text-align: center; display: none; }
    </style>
</head>
<body>
    <header>
        <strong>PIPI SYSTEM</strong>
        <button onclick="location.reload()">Reload</button>
    </header>
    <div id="video-grid"></div>

    <script>
        // ðŸ‘‡ Cáº¤U HÃŒNH QUAN TRá»ŒNG: CHUYá»‚N Vá»€ HTTPS VÃ€ /hls/ Äá»‚ TRÃNH Lá»–I 404
        const SERVER_HOST = 'https://triduckinglive.ddns.net:4433';
        
        // ðŸ‘‡ KIá»‚M TRA Ká»¸ TÃŠN LUá»’NG TRONG MISTSERVER CÃ“ KHá»šP Vá»šI DANH SÃCH NÃ€Y KHÃ”NG?
        // Náº¿u trong MistServer lÃ  "pipi1" (khÃ´ng gáº¡ch ngang) thÃ¬ báº¡n pháº£i sá»­a á»Ÿ Ä‘Ã¢y thÃ nh 'pipi1'
        const STREAMS = [
            'source', 'source1', 'source2',
            'pipi-1', 'pipi-2', 'pipi-3', 'pipi-4', 'pipi-5', 
            'pipi-6', 'pipi-7', 'pipi-8', 'pipi-9', 'pipi-10', 
            'pipi-11', 'pipi-12', 'pipi-13', 'pipi-14', 'pipi-15'
        ];

        document.addEventListener("DOMContentLoaded", () => {
            const grid = document.getElementById('video-grid');
            STREAMS.forEach(name => {
                const div = document.createElement('div');
                div.className = 'cam-box';
                div.innerHTML = `
                    <div class="label">${name}</div>
                    <div class="error-msg" id="err-${name}">Offline</div>
                    <video id="v-${name}" muted playsinline autoplay></video>
                `;
                grid.appendChild(div);
                load(name);
            });
        });

        function load(name) {
            const video = document.getElementById(`v-${name}`);
            const errDiv = document.getElementById(`err-${name}`);
            
            // ðŸ‘‰ QUAY Vá»€ ÄÆ¯á»œNG DáºªN /hls/ (AN TOÃ€N NHáº¤T)
            const url = `${SERVER_HOST}/hls/${name}/index.m3u8`;

            video.onerror = () => {
                errDiv.style.display = 'block'; // Hiá»‡n chá»¯ Offline náº¿u lá»—i 404
                errDiv.innerText = "Error/404";
            };

            if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
            } else if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        errDiv.style.display = 'block';
                        console.log(`Stream ${name} error:`, data);
                    }
                });
            }
        }
    </script>
</body>
</html>
